<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>CloudModule for Zabbix by ike-dai</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>CloudModule for Zabbix</h1>
          <h2>Hybrid Cloud Monitoring Zabbix Loadable Module.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/ike-dai/zabbix-cloud-module/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/ike-dai/zabbix-cloud-module/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/ike-dai/zabbix-cloud-module" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h1>

<p><strong>CloudModule for Zabbix</strong></p>

<p>Hybrid Cloud Monitoring Module by using Deltacloud.<br>
This tool is for Zabbix Loadable Module.</p>

<p>Zabbix loadable modules is supported over Zabbix 2.2.0.</p>

<h1>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h1>

<ul>
<li>Automatically registration EC2 instances information.</li>
<li>Automatically registration EC2 CloudWatch metrics information.</li>
</ul><h1>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h1>

<ul>
<li>Setup Deltacloud server. (tested in Deltacloud 1.1.3)</li>
<li>libdeltacloud customized for this tool</li>
<li>Zabbix &gt;= 2.2.0</li>
</ul><h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<h2>
<a name="1-install-deltacloud" class="anchor" href="#1-install-deltacloud"><span class="octicon octicon-link"></span></a>1. Install Deltacloud</h2>

<p>Deltacloud is made by Ruby.<br>
So, please install ruby (&gt;= 1.9.2).</p>

<p>And, install rubygems.</p>

<p>You can install deltacloud by using gem command.</p>

<pre><code>$ sudo gem install splite3 deltacloud-core
</code></pre>

<p>If you have installed thin &gt;= 2.0.0, please reinstall thin version 1.6.2</p>

<pre><code>$ sudo gem uninstall thin
$ sudo gem install thin --version=1.6.2
</code></pre>

<p>If you have installed haml &gt;= 4.0.5, please reinstall haml version 4.0.4</p>

<pre><code>$ sudo gem uninstall haml
$ sudo gem install haml --version=4.0.4
</code></pre>

<h2>
<a name="2-apply-one-patch-to-deltacloud" class="anchor" href="#2-apply-one-patch-to-deltacloud"><span class="octicon octicon-link"></span></a>2. Apply one patch to Deltacloud</h2>

<p>It is not possible to get AWS CloudWatch metrics from Deltacloud 1.1.3.
So, please apply patch <a href="https://github.com/ike-dai/deltacloud-core/commit/61b690698c949fb7c92607651f1ctc5e02971df966">https://github.com/ike-dai/deltacloud-core/commit/61b690698c949fb7c92607651f1ctc5e02971df966</a>.</p>

<pre><code>$ cd &lt;rubygems dircetory&gt;/deltacloud-core-1.1.3
$ vim lib/deltacloud/drivers/ec2/ec2_driver.rb
    #start_time, end_time, metric_unit_for(p.name), { m.entity =&gt; opts[:id]})     &lt;- comment out
    start_time, end_time, metric_unit_for(p.name), {:dimensions =&gt; { m.entity =&gt; opts[:id]}})
</code></pre>

<h2>
<a name="3-start-deltacloudd" class="anchor" href="#3-start-deltacloudd"><span class="octicon octicon-link"></span></a>3. Start deltacloudd</h2>

<p><strong>Please start Deltacloud daemon.</strong></p>

<pre><code>$ sudo deltacloudd -i ec2 -p 3000 &amp;
</code></pre>

<h2>
<a name="4-install-libdeltacloud-for-cloudmodule" class="anchor" href="#4-install-libdeltacloud-for-cloudmodule"><span class="octicon octicon-link"></span></a>4. Install libdeltacloud-for-cloudmodule</h2>

<p><strong>Clone libdeltacloud-for-cloudmodule git repository from GitHub.</strong></p>

<pre><code>$ git clone https://github.com/ike-dai/libdeltacloud-for-cloudmodule.git
</code></pre>

<p><strong>Complile &amp; Install</strong></p>

<pre><code>$ sudo yum install libtool
$ sudo yum install libcurl-devel
$ cd libdeltacloud-for-cloudmodule
$ ./autogen.sh
$ ./configure
$ make
$ sudo make install
</code></pre>

<p>(As default, this library will be installed in /usr/local/lib.)</p>

<p><strong>Update shared library path.</strong></p>

<pre><code>$ sudo vim /etc/ld.so.conf.d/libdeltacloud.conf
/usr/local/lib
$ sudo ldconfig
</code></pre>

<h2>
<a name="5-compile--install-cloudmodule" class="anchor" href="#5-compile--install-cloudmodule"><span class="octicon octicon-link"></span></a>5. Compile &amp; Install CloudModule</h2>

<p><strong>Clone CloudModule git repository from GitHub.</strong></p>

<pre><code>$ git clone https://github.com/ike-dai/zabbix-cloud-module.git
</code></pre>

<p>Copy Makefile &amp; source code to Zabbix source code directory.<br>
If you don't have Zabbix source code, please download it.</p>

<pre><code>$ wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.2.4/zabbix-2.2.4.tar.gz
$ tar xvzf zabbix-2.2.4.tar.gz
$ cd zabbix-2.2.4
$ ./configure --enable-server --with-sqlite3
$ make

$ cp -r zabbix-cloud-module ./src/modules/
</code></pre>

<p><strong>Complile</strong></p>

<pre><code>$ cd src/modules/zabbix-cloud-module
$ make
</code></pre>

<p><strong>Error message</strong><br>
If you get the following error, please recompile libs/zbxmemory/memalloc.c</p>

<pre><code>gcc -shared -o cloud_module.so cloud_module.c ../../libs/zbxmemory/memalloc.o -I../../../include -ldeltacloud -fPIC
/usr/bin/ld: ../../libs/zbxmemory/memalloc.o: relocation R_X86_64_32 against `.rodata.str1.8' can not be used when making a shared object; recompile with -fPIC
../../libs/zbxmemory/memalloc.o: could not read symbols: Bad value
collect2: ld returned 1 exit status

$ cd src/libs/zbxmemory/
$ make clean
$ vi Makefile
CFLAGS = -g -O2     -I/usr/include -fPIC   &lt;--- Add "-fPIC"
$ make
</code></pre>

<p><strong>Copy the shared library file.</strong></p>

<pre><code>$ mkdir /usr/lib/zabbix/modules
$ cp cloud_module.so /usr/lib/zabbix/modules/
</code></pre>

<h2>
<a name="6-copy-configurateion-file" class="anchor" href="#6-copy-configurateion-file"><span class="octicon octicon-link"></span></a>6. Copy configurateion file</h2>

<p>Please copy cloud_module.conf.example to /etc/zabbix/cloud_module.conf.
And set values.</p>

<pre><code>$ cp cloud_module.conf.example /etc/zabbix/cloud_module.conf
$ vim /etc/zabbix/cloud_module.conf
ModuleTimeout=300
ModuleCloudCacheSize=4M
ZabbixFile="/etc/zabbix/zabbix_server.conf"
</code></pre>

<p><strong>Notes: cloud_module.conf must be placed under "/etc/zabbix" directory.</strong></p>

<h2>
<a name="7-set-loadablemodule-configurations" class="anchor" href="#7-set-loadablemodule-configurations"><span class="octicon octicon-link"></span></a>7. Set LoadableModule configurations</h2>

<p>Please set LoadableModulePath,LoadableModule in zabbix_server.conf(or zabbix_agentd.conf)<br>
Loadable Module is used in Zabbix Server or Zabbix Agent.</p>

<ul>
<li>When you can use in Zabbix Server(as Simple check item), please edit "zabbix_server.conf".</li>
<li>
<p>When you can use in Zabbix Agent(as Zabbix Agent item), please edit "zabbix_agentd.conf".</p>

<p>$ vim /etc/zabbix/zabbix_server.conf</p>

<p>LoadableModulePath=/usr/lib/zabbix/modules
LoadableModule=cloud_module.so</p>
</li>
</ul><h2>
<a name="8-import-cloudmodule-template-to-zabbix-server" class="anchor" href="#8-import-cloudmodule-template-to-zabbix-server"><span class="octicon octicon-link"></span></a>8. Import CloudModule template to Zabbix server</h2>

<p>Please import templates/cloud_module_templates.xml in Zabbix frontend [Configuration] -&gt; [Templates] -&gt; [Import]</p>

<p>By importing this xml, two templates will be added.</p>

<ul>
<li>Template Cloud Module</li>
<li>Template Cloud Module VM</li>
</ul><h2>
<a name="9-add-cloud-monitoring-host" class="anchor" href="#9-add-cloud-monitoring-host"><span class="octicon octicon-link"></span></a>9. Add Cloud monitoring host</h2>

<p>Add host.</p>

<p>For example:</p>

<ul>
<li>Host name: AWS Account A</li>
<li>Host group: Cloud monitoring</li>
<li>Interface: Any (This module does not use interface information.)</li>
<li>Templates: Template Cloud Module</li>
<li>Macros:

<ul>
<li>{$DELTACLOUD_DRIVER} -&gt; ec2 (Now this module support only ec2)</li>
<li>{$DELTACLOUD_PASSWORD} -&gt; AWS API Secret key</li>
<li>{$DELTACLOUD_PROVIDER} -&gt; ap-northeast-1 (support any other region name)</li>
<li>{$DELTACLOUD_URL} -&gt; http://localhost:3000/api (please set your deltacloud URL)</li>
<li>{$DELTACLOUD_USERNAME} -&gt; AWS API Access key</li>
</ul>
</li>
</ul><p>When these settings are finished, monitoring the status of AWS will start automatically.</p>

<h1>
<a name="contact" class="anchor" href="#contact"><span class="octicon octicon-link"></span></a>Contact</h1>

<p>Please send feedback to me.</p>

<p>DAISUKE Ikeda</p>

<p>Twitter: <a href="https://twitter.com/ike_dai">@ike_dai</a></p>

<p>e-mail: <a href="mailto:dai.ikd123@gmail.com">dai.ikd123@gmail.com</a></p>

<h1>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h1>

<p>CloudModule for Zabbix is released under the GNU General Public License version2.
The GPL official full text is published at this <a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt">link</a>.</p>

<p>Copyright 2014 DAISUKE Ikeda.</p>
        </section>

        <footer>
          CloudModule for Zabbix is maintained by <a href="https://github.com/ike-dai">ike-dai</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>